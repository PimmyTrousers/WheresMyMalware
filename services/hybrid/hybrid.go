package hybrid

import (
	"errors"
	"os"

	hybrid "github.com/Nishan8583/HybridApi/Hybrid"
	"github.com/pimmytrousers/WheresMyMalware/malsrc"
)

type Client struct {
	cli hybrid.GoHybrid
}

func (c Client) QueryForSample(hash string) (bool, error) {
	res, err := c.cli.SearchHash(hash)
	if err != nil {
		return false, err
	}

	if len(res) == 0 {
		return false, nil
	}

	return true, nil
}

func (c Client) DownloadSample(hash string) ([]byte, error) {
	return nil, nil
}

func Initialize() (malsrc.MalwareService, error) {
	c := &Client{}
	key := os.Getenv("HAAPIKey")
	if len(key) == 0 {
		return nil, errors.New("no API key set for Hybrid Analysis")
	}

	h, err := hybrid.HybridInit(key)
	if err != nil {
		return nil, err
	}

	c.cli = h

	return c, nil
}
